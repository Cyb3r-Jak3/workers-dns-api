(()=>{var e={470:e=>{e.exports={Router:({base:e="",routes:t=[]}={})=>({__proto__:new Proxy({},{get:(r,o,s)=>(r,...n)=>t.push([o.toUpperCase(),RegExp(`^${(e+r).replace(/(\/?)\*/g,"($1.*)?").replace(/\/$/,"").replace(/:(\w+)(\?)?(\.)?/g,"$2(?<$1>[^/]+)$2$3").replace(/\.(?=[\w(])/,"\\.")}/*$`),n])&&s}),routes:t,async handle(e,...r){let o,s,n=new URL(e.url);for(var[a,i,p]of(e.query=Object.fromEntries(n.searchParams),t))if((a===e.method||"ALL"===a)&&(s=n.pathname.match(i)))for(var u of(e.params=s.groups,p))if(void 0!==(o=await u(e.proxy||e,...r)))return o}})}},923:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.queryEndpoint=void 0;const o=r(279),s=r(147);t.queryEndpoint=async function(e){const t=await e.json();if(void 0===t.server&&(t.server=o.DEFAULT_DOH_SERVER),void 0===t.question||void 0===t.type)return(0,s.JSONErrorResponse)("Need both'question', and 'type' set",400);const r=await(0,o.DNSQuery)(t);return-1===r.Status?(0,s.JSONErrorResponse)("Error getting DNS Response"):(0,s.JSONResponse)(r)}},473:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetUsedDNSServer=t.DNSCryptInfo=void 0;const o=r(147),s="https://download.dnscrypt.info/dnscrypt-resolvers/json/public-resolvers.json";async function n(){const e=caches.default;let t=await e.match(s);if(!t){const r=await fetch(s,{headers:{accept:"application/json"}});if(200!==r.status)return console.error(r.statusText),(0,o.JSONErrorResponse)("Error getting upstream info");t=(0,o.JSONResponse)(await r.json()),e.put(s,t.clone())}return t}t.DNSCryptInfo=async function(){return await n()},t.GetUsedDNSServer=async function(){let e=await KEYS.get("DoH_SERVERS",{type:"json"});if(null===e){const t=await(await n()).json();let r=[];t.forEach((e=>{e.nofilter&&"DoH"===e.proto&&r.push(e)})),e=r,await KEYS.put("DoH_SERVERS",JSON.stringify(r),{expirationTtl:86400})}return(0,o.JSONResponse)(e)}},279:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DNSQuery=t.DEFAULT_DOH_SERVER=void 0,t.DEFAULT_DOH_SERVER="https://cloudflare-dns.com/dns-query",t.DNSQuery=async function(e){const t=new URL(e.server);t.search=new URLSearchParams({name:e.question,type:e.type}).toString();const r=await fetch(t.toString(),{headers:{accept:"application/dns-json"}});return 200!==r.status?(console.log("Query URL: ",t.toString()),console.log(r.statusText),{Status:-1,TC:!1,AD:!1,RD:!1,RA:!1,Question:[],Answer:[]}):await r.json()}},341:(e,t,r)=>{"use strict";t.p=void 0;const o=r(923),s=r(470),n=r(147),a=r(473),i=(0,s.Router)();t.p=e=>{if(!(e.headers.get("content-type")||"").includes("application/json"))return(0,n.JSONErrorResponse)("Not a JSON Body",400)},i.get("/",(()=>new Response("Homepage for DNS API. Nothing here right now but there are other endpoints. Checkout the repo: https://github.com/Cyb3r-Jak3/workers-dns-api"))),i.get("/nameservers/used",a.GetUsedDNSServer),i.get("/nameservers/all",a.DNSCryptInfo),i.get("/query",t.p,o.queryEndpoint),i.all("*",(()=>new Response("404, not found!",{status:404}))),addEventListener("fetch",(e=>{e.respondWith(i.handle(e.request))}))},147:(e,t)=>{"use strict";function r(e,t=200,r){const o=new Headers({"content-type":"application/json; charset=UTF-8"});return r&&r.forEach((e=>{o.append(e[0],e[1])})),new Response(JSON.stringify(e),{status:t,headers:o})}Object.defineProperty(t,"__esModule",{value:!0}),t.JSONErrorResponse=t.JSONResponse=void 0,t.JSONResponse=r,t.JSONErrorResponse=function(e,t=500){return r({Error:e},t)}}},t={};!function r(o){var s=t[o];if(void 0!==s)return s.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}(341)})();