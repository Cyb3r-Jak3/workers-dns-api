(()=>{var e={470:e=>{e.exports={Router:({base:e="",routes:t=[]}={})=>({__proto__:new Proxy({},{get:(r,o,n)=>(r,...s)=>t.push([o.toUpperCase(),RegExp(`^${(e+r).replace(/(\/?)\*/g,"($1.*)?").replace(/\/$/,"").replace(/:(\w+)(\?)?(\.)?/g,"$2(?<$1>[^/]+)$2$3").replace(/\.(?=[\w(])/,"\\.").replace(/\)\.\?\(([^\[]+)\[\^/g,"?)\\.?($1(?<=\\.)[^\\.")}/*$`),s])&&n}),routes:t,async handle(e,...r){let o,n,s=new URL(e.url);for(var[a,i,p]of(e.query=Object.fromEntries(s.searchParams),t))if((a===e.method||"ALL"===a)&&(n=s.pathname.match(i)))for(var c of(e.params=n.groups,p))if(void 0!==(o=await c(e.proxy||e,...r)))return o}})}},923:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.queryEndpoint=void 0;const o=r(279),n=r(147),s=caches.default;t.queryEndpoint=async function(e){let t=await s.match(e);if(!t){const r=await e.json();if(void 0===r.server&&(r.server=o.DEFAULT_DOH_SERVER),void 0===r.question||void 0===r.type)return(0,n.JSONErrorResponse)("Need both'question', and 'type' set",400);const a=await(0,o.DNSQuery)(r);if(-1===a.Status)return(0,n.JSONErrorResponse)("Error getting DNS Response");t=(0,n.JSONResponse)(a,200,[["Cache-Control",a.Answer[0].TTL.toString()]]),await s.put(e,t.clone())}return t}},473:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetUsedDNSServer=t.DNSCryptInfo=void 0;const o=r(147),n="https://download.dnscrypt.info/dnscrypt-resolvers/json/public-resolvers.json",s=caches.default;async function a(){let e=await s.match(n);if(!e){const t=await fetch(n,{headers:{accept:"application/json"}});if(200!==t.status)return console.error(t.statusText),(0,o.JSONErrorResponse)("Error getting upstream info");e=(0,o.JSONResponse)(await t.json()),await s.put(n,e.clone())}return e}t.DNSCryptInfo=async function(){return await a()},t.GetUsedDNSServer=async function(e){let t=await s.match(e);if(!t){let r=await KEYS.get("DoH_SERVERS",{type:"json"});if(null===r){const e=await(await a()).json();let t=[];e.forEach((e=>{e.nofilter&&"DoH"===e.proto&&t.push(e)})),r=t,await KEYS.put("DoH_SERVERS",JSON.stringify(t),{expirationTtl:86400})}t=(0,o.JSONResponse)(r,200,[["Cache-Control","86400"]]),await s.put(e,t.clone())}return t}},279:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DNSQuery=t.DEFAULT_DOH_SERVER=void 0,t.DEFAULT_DOH_SERVER="https://cloudflare-dns.com/dns-query",t.DNSQuery=async function(e){const t=new URL(e.server);t.search=new URLSearchParams({name:e.question,type:e.type}).toString();const r=await fetch(t.toString(),{headers:{accept:"application/dns-json"}});return 200!==r.status?(console.log("Query URL: ",t.toString()),console.log(r.statusText),{Status:-1,TC:!1,AD:!1,RD:!1,RA:!1,Question:[],Answer:[]}):await r.json()}},341:(e,t,r)=>{"use strict";t.p=void 0;const o=r(923),n=r(470),s=r(147),a=r(473),i=(0,n.Router)();t.p=e=>{if(!(e.headers.get("content-type")||"").includes("application/json"))return(0,s.JSONErrorResponse)("Not a JSON Body",400)},i.get("/",(()=>new Response("Homepage for DNS API. Nothing here right now but there are other endpoints. Checkout the repo: https://github.com/Cyb3r-Jak3/workers-dns-api"))),i.get("/nameservers/used",a.GetUsedDNSServer),i.get("/nameservers/all",a.DNSCryptInfo),i.get("/query",t.p,o.queryEndpoint),i.all("*",(()=>new Response("404, not found!",{status:404}))),addEventListener("fetch",(e=>{e.respondWith(i.handle(e.request))}))},147:(e,t)=>{"use strict";function r(e,t=200,r){const o=new Headers({"content-type":"application/json; charset=UTF-8"});return r&&r.forEach((e=>{o.append(e[0],e[1])})),new Response(JSON.stringify(e),{status:t,headers:o})}Object.defineProperty(t,"__esModule",{value:!0}),t.JSONErrorResponse=t.JSONResponse=void 0,t.JSONResponse=r,t.JSONErrorResponse=function(e,t=500){return r({Error:e},t)}}},t={};!function r(o){var n=t[o];if(void 0!==n)return n.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,r),s.exports}(341)})();